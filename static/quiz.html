<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quiz App</title>
    <!-- React and ReactDOM CDN -->
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>

    <!-- Babel Standalone CDN for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <link rel="stylesheet" href="https://fonts.xz.style/serve/inter.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@exampledev/new.css@1.1.2/new.min.css"
    />
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      function Quiz() {
        const [questions, setQuestions] = React.useState([]);

        const [newQuestion, setNewQueston] = React.useState("");
        const [newAnswer, setNewAnswer] = React.useState("");
        const [quiz, setQuiz] = React.useState("");

        React.useEffect(async () => {
          // Get the query parameters from the current URL
          const urlSearchParams = new URLSearchParams(window.location.search);

          // Get the value of the 'quizname' parameter
          const quizName = urlSearchParams.get("quizname");
          setQuiz(quizName);

          if (quizName) {
            const response = await fetch("/quiz/" + quizName, {
              method: "GET",
              headers: {
                "Content-Type": "application/json",
              },
            });
            if (response.status == 200) {
              const data = await response.json();
              setQuestions(data.questions);
            }
          }
        }, []);

        async function createQuestion() {
          const response = await fetch("/quiz/" + quiz, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              question: newQuestion,
              answer: newAnswer,
            }),
          });

          setQuestions([
            { question: newQuestion, answer: newAnswer },
            ...questions,
          ]);
        }

        return (
          <div>
            <form>
              <p>
                <h3>Create New Question</h3>
                <input
                  placeholder="question"
                  onInput={(e) => setNewQueston(e.target.value)}
                />
              </p>
              <p>
                <input
                  placeholder="answer"
                  onInput={(e) => setNewAnswer(e.target.value)}
                />
              </p>
              <button onClick={createQuestion} type="button">
                Create
              </button>
            </form>

            <ul>
              {questions.map((question) => {
                return (
                  <details>
                    <summary>{question.question}</summary>
                    <p>{question.answer}</p>
                  </details>
                );
              })}
            </ul>
          </div>
        );
      }

      // Render the QuizApp component into the root div
      ReactDOM.render(<Quiz />, document.getElementById("root"));
    </script>
  </body>
</html>
